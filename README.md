# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание данных

### Интерфейсы

```
// модель товара
export interface IItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}

// карточка товара
export interface ICard extends IItem {
	index?: number;
}

// для всех видов форм в проекте
export interface IAnyForm extends IOrderForm, IContactsForm {}

// данные заказа для отправки на бэкенд
export interface IOrder extends IAnyForm {
	total: number;
	items: Uuid[];
}

// модель состояния приложения
export interface IAppState {
	catalog: IItem[];
	basket: IItem[];
	order: IOrder;
	orderFormErrors: OrderFormErrors;
	contactsFormErrors: ContactsFormErrors;
}

// для id
export type Uuid = string;

// главная страница
export interface IMainPage {
	cartCounter: number;
	catalog: HTMLElement[];
}

// для формы заказа
export interface IOrderForm {
	address: string;
	payment: string;
}

// для формы контактов
export interface IContactsForm {
	email: string;
	phone: string;
}

// ошибки формы заказа и контактов
export type OrderFormErrors = Partial<Record<keyof IOrderForm, string>>;
export type ContactsFormErrors = Partial<Record<keyof IContactsForm, string>>;

// ответ сервера в случае удачного оформления заказа
export interface IOrderResult {
	id: Uuid;
	total: number;
}

// ответ сервера для списка объектов
export type ApiListResponse<Type> = {
	total: number;
	items: Type[];
};

// имена форм
export type FormName = 'order' | 'contacts';
```

### Базовый код

#### Класс EventEmitter

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события. Класс имеет методы on, off, emit для подписки на событие, отписки от события и уведомления подписчиков о наступлении события соответственно. Дополнительно реализованы методы onAll и offAll для подписки на все события и сброса всех подписчиков,trigger для генерации заданного события с заданными аргументами.

#### Класс Model<T>

Абстрактный, является базовым для моделей данных. Принимает в переменной T тип данных модели. Содержит события Event Emitter. Имеет метод emitChanges, позволяющий оповестить об изменениях в модели.

#### Класс Component<T>

Абстрактный, является базовым классом для компонентов интерфейса. Класс является дженериком и принимает в переменной T тип данных, которые могут быть переданы в метод render для отображения. Содержит элемент контейнера и методы управления - переключение класса toggleClass, установка текстового содержимого setText, смена статуса блокировки setDisabled, установка изображения setImage, получение обработанного элемента-контейнера render.

#### Класс Api

Реализует обмен данными с сервером с помощью методов get и post.

### Классы

#### Модели данных

##### Класс Item

Содержит данные карточки товара: id, название, описание, ссылка на изображение, категория, цена.

##### Класс AppState

Описывает состояние приложения. Хранит данные карточек товара, выводимых на главной странице, состояние заказа, корзины. Содержит методы добавления товара в корзину (addBasket) и удаления (deleteBasket), обновления каталога (setCatalog), получения количества (getNumberBasket) и стоимости товаров (getTotalBasket) в корзине, определения наличия товара в корзине (isInBasket), валидации форм (validate), подготовки заказа к отправке на сервер (prepareOrder), очистки корзины (cleanBasketState) и заказа (cleanOrderItems), также геттеры для свойств.

#### Компоненты представления

##### Класс Page

Описывает главную страницу. Содежит методы задания значения счётчика корзины (counter) и карточек (catalog), сеттер поля для блокировки страницы (locked).

##### Класс Card

Карточка товара. Содержит сеттеры полей карточки: id, title, image, category, price, text, метки присутствия товара в корзине isInBasket.

##### Класс Basket

Корзина. Содержит сеттер для общей стоимости (total), списка товаров (items), метод блокировки кнопки в зависимости от наличия товаров с ненулевой ценой в корзине (disableButton).

##### Класс Form<T>

Базовый для всех форм. Содержит метод valid, блокирующий или разблокирующий кнопку отправки в зависимости от переданного значения, метод errors - задание текста ошибок формы.

##### Класс Order

Производный от Form. Определяет форму заказа. Содержит сеттеры для свойств address, payment.

##### Класс Contacts

Производный от Form. Определяет форму контактов. Содержит сеттеры email и phone.

##### Класс Modal

Определяет модальное окно. Содержит методы открытия (open) и закрытия (close), сеттер для содержания окна.

#### Взаимодействие с сервером

##### Класс LarekApi

Производный от Api. Реализует обмен данными с сервером проекта. Методы getItemList для получения с сервера списка товаров, postOrder для отправки заказа.

### События

- items:changed - при обновлении списка товаров в данных, вызывает перерисовку списка товаров
- card:select - открывает модальное окно с подробной карточкой товара при клике на товар с списке
- basket:changed - при изменении данных корзины вызывает перерисовку количества товаров в корзине на главной
- modal:open - при открытии модального окна блокирует страницу
- modal:close - при закрытии модального окна снимает блокировку страницы
- basket:open - открывает модальное окно с корзиной при клике на неё
- order:open - открытие окна заказа при нажатии кнопки в корзине
- ^(order|contacts)\..*:change - при изменении поля формы результат пишется в данные
- orderFormErrors:change - при изменении состояния валидации формы заказа валидируются поля и принимается решение о блокировке/разблокировке формы
- contactsFormErrors:change - то же для формы контактов
- order:submit - при нажатии "Далее" в окне заказа открывается форма контактов
- contacts:submit - при нажатии "Оформить" в окне контактов заказ отправляется на сервер
- order:success - при получении ответа 20x от сервера в модальном окне отрисовывается "Заказ успешно оформлен", товары удаляются из корзины и заказа
